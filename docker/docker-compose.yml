# Copyright (C) 2017-2026 Smart Code OOD 203358507
# Docker Compose configuration for stremio-service

services:
  stremio:
    build:
      context: ..
      dockerfile: docker/Dockerfile.light
      args:
        SERVER_VERSION: ${SERVER_VERSION:-v4.20.16}
        NODE_VERSION: ${NODE_VERSION:-v20.10.0}
    image: stremio-service:latest
    restart: unless-stopped
    
    # Required for IP banning with iptables
    cap_add:
      - NET_ADMIN
      - NET_RAW
    
    environment:
      - NO_CORS=1
      - AUTO_SERVER_URL=1
      - ENABLE_IP_BAN=1
      - BAN_THRESHOLD=10
      - BAN_WINDOW=60
      - BAN_DURATION=3600
      - LOG_LEVEL=info
    
    volumes:
      - stremio-data:/data
      - stremio-bans:/var/lib/stremio-bans
    
    healthcheck:
      test: ["CMD", "/app/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

volumes:
  stremio-data:
    driver: local
  stremio-bans:
    driver: local